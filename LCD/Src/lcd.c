/*
 * lcd.c
 *
 *  Created on: Feb 5, 2020
 *      Author: igor.dymov
 */
#include "lcd.h"
#include "main.h"

#include "u8g2.h"

#include "server.h"
#include "rtc.h"


#define home18_width 18
#define home18_height 18
static unsigned char home18_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x80, 0x04, 0x00,
   0x40, 0x08, 0x00, 0x20, 0x10, 0x00, 0x10, 0x20, 0x00, 0x00, 0x00, 0x00,
   0x04, 0x80, 0x00, 0x86, 0x87, 0x01, 0x80, 0x04, 0x00, 0x80, 0x04, 0x00,
   0x80, 0x04, 0x00, 0x80, 0x04, 0x00, 0xc8, 0x4c, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };


#define icons8_width 20
#define icons8_height 20
static unsigned char icons8_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x09, 0x00, 0x38, 0xc9, 0x01,
   0xc8, 0x30, 0x01, 0x08, 0x00, 0x01, 0x10, 0x80, 0x00, 0x10, 0x8f, 0x00,
   0x8e, 0x10, 0x07, 0x82, 0x10, 0x04, 0x82, 0x10, 0x04, 0x8e, 0x10, 0x07,
   0x10, 0x8f, 0x00, 0x10, 0x80, 0x00, 0x08, 0x00, 0x01, 0xc8, 0x30, 0x01,
   0x38, 0xc9, 0x01, 0x00, 0x09, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x00 };

static unsigned char icons8_1_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x07, 0x00, 0x40, 0x06,
   0x00, 0x20, 0x00, 0x00, 0x10, 0x01, 0x00, 0x88, 0x00, 0x00, 0x44, 0x00,
   0x00, 0x22, 0x00, 0x00, 0x11, 0x00, 0x80, 0x08, 0x00, 0x40, 0x04, 0x00,
   0x20, 0x02, 0x00, 0x10, 0x01, 0x00, 0x88, 0x00, 0x00, 0x44, 0x00, 0x00,
   0x26, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00 };
static unsigned char icons8_2_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x30, 0x00,
   0xa0, 0x59, 0x00, 0x30, 0xcf, 0x00, 0x0c, 0x00, 0x03, 0x04, 0x00, 0x02,
   0x06, 0x00, 0x06, 0x7e, 0xe0, 0x07, 0xc6, 0x30, 0x06, 0x83, 0x1f, 0x0c,
   0x81, 0x19, 0x08, 0x81, 0x1f, 0x08, 0x83, 0x19, 0x0c, 0xc2, 0x30, 0x04,
   0x7c, 0xe0, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

static unsigned char home_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x0f, 0x00,
   0x80, 0x19, 0x00, 0xc0, 0x30, 0x00, 0x60, 0x60, 0x00, 0x30, 0xc0, 0x00,
   0x08, 0x00, 0x01, 0x0c, 0x00, 0x03, 0x8e, 0x1f, 0x07, 0x88, 0x19, 0x01,
   0x88, 0x19, 0x01, 0x88, 0x19, 0x01, 0x88, 0x19, 0x01, 0x88, 0x19, 0x01,
   0xf8, 0xf9, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

static unsigned char fold_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x61, 0x00, 0x00, 0xc1, 0xff, 0x03,
   0x01, 0x00, 0x04, 0x01, 0x00, 0x04, 0x05, 0x00, 0x08, 0x05, 0x00, 0x08,
   0x05, 0x00, 0x08, 0x03, 0x00, 0x00, 0x03, 0x00, 0x00, 0x03, 0x00, 0x04,
   0x03, 0x00, 0x04, 0x03, 0x00, 0x04, 0x01, 0x00, 0x04, 0x01, 0x00, 0x00,
   0x01, 0x00, 0x02, 0x01, 0x00, 0x02, 0xfe, 0xff, 0x01, 0x00, 0x00, 0x00 };

static unsigned char fac_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x20, 0x0e, 0x00, 0x70, 0x07,
   0x00, 0x70, 0x03, 0x00, 0x38, 0x00, 0x00, 0x80, 0x03, 0x00, 0x38, 0x03,
   0x00, 0x98, 0x03, 0xff, 0x19, 0x03, 0x93, 0x19, 0x03, 0x11, 0x19, 0x03,
   0x11, 0x19, 0x03, 0x11, 0xff, 0x03, 0xff, 0xff, 0x03, 0xff, 0xbd, 0x03,
   0x11, 0xbd, 0x07, 0x93, 0xff, 0x07, 0xff, 0xff, 0x07, 0x00, 0x00, 0x00 };

static unsigned char akk_bits[] = {
   0xf8, 0xf0, 0x01, 0xfc, 0xf9, 0x03, 0x8c, 0x19, 0x03, 0x8c, 0x19, 0x03,
   0xff, 0xff, 0x0f, 0x03, 0x00, 0x0c, 0x03, 0x00, 0x0c, 0x63, 0x00, 0x0c,
   0xf3, 0xf0, 0x0c, 0xf3, 0xf0, 0x0c, 0x63, 0x00, 0x0c, 0x03, 0x00, 0x0c,
   0x03, 0x00, 0x0c, 0x03, 0x00, 0x0c, 0x03, 0x00, 0x0c, 0x03, 0x00, 0x0c,
   0x03, 0x00, 0x0c, 0x03, 0x00, 0x0c, 0xff, 0xff, 0x0f, 0xfe, 0xff, 0x07 };


#define light_footer_logo_energan_spb_width 128
#define light_footer_logo_energan_spb_height 35
static unsigned char light_footer_logo_energan_spb_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x7e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xff, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x0f, 0xf0,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xd8, 0x17, 0xe0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x37, 0xe0, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7d, 0xe0,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x70, 0xbe, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xff, 0x70,
   0xe0, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xff, 0xff, 0x79, 0xf8, 0x87, 0x01, 0xe7, 0xff, 0xfc, 0x8f, 0xff,
   0xc3, 0x03, 0x07, 0x0e, 0x80, 0xef, 0xff, 0x38, 0xfe, 0x8f, 0x01, 0xe7,
   0xff, 0xfc, 0x9f, 0xff, 0xc3, 0x07, 0x07, 0x0e, 0x80, 0xf3, 0xff, 0x3d,
   0x1c, 0x9e, 0x01, 0xe7, 0x00, 0x1c, 0xbc, 0x03, 0xe0, 0x07, 0x07, 0x0e,
   0xc0, 0xf7, 0xff, 0x1e, 0x00, 0x9c, 0xff, 0xe7, 0x1f, 0x0c, 0xb8, 0x03,
   0xe0, 0x0e, 0xff, 0x0f, 0xc0, 0xff, 0x7f, 0x0e, 0xc0, 0xbf, 0xff, 0xe7,
   0x1f, 0xfc, 0x9f, 0x03, 0x70, 0x0e, 0xff, 0x0f, 0x80, 0xff, 0x7f, 0x0f,
   0xc0, 0xbf, 0xff, 0xe7, 0x1f, 0xfc, 0x9f, 0x03, 0xf0, 0x1f, 0xff, 0x0f,
   0x00, 0xff, 0x9c, 0x0f, 0x0c, 0x9c, 0x01, 0xe7, 0x00, 0xfc, 0x87, 0x03,
   0xf8, 0x1f, 0x07, 0x0e, 0x00, 0x7f, 0xc8, 0x07, 0x3e, 0x9f, 0x01, 0xe7,
   0x80, 0x0c, 0x80, 0x03, 0xf8, 0x3f, 0x07, 0x0e, 0x00, 0x3f, 0xe0, 0x05,
   0xfc, 0x8f, 0x01, 0xe7, 0xff, 0x0c, 0x80, 0x03, 0x1c, 0x78, 0x07, 0x0e,
   0x00, 0x3e, 0xf0, 0x06, 0xf8, 0x83, 0x01, 0xe7, 0xff, 0x0c, 0x80, 0x03,
   0x1e, 0x70, 0x07, 0x0e, 0x20, 0x1e, 0x78, 0x02, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x1e, 0x3c, 0x01,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x30, 0x0c, 0x1f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x30, 0x88, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0xe0, 0x17, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x80, 0x00,
   0x70, 0xfc, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x08, 0x00, 0xf0, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf0, 0x3f, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0xe0, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

#define i_width 133
#define i_height 64
static unsigned char i_bits[] = {
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x10, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x61, 0x0c,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x48, 0x00, 0x00, 0x02, 0x00,
   0x00, 0x00, 0x40, 0x92, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
   0x61, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x42, 0x12, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x10, 0x00, 0x30, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00,
   0x00, 0x41, 0x12, 0x20, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x60, 0x00,
   0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x12, 0x00, 0x00, 0x00, 0xb0,
   0x02, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x98,
   0x12, 0x00, 0x00, 0x00, 0x40, 0x02, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0xc0, 0x73, 0x0c, 0x00, 0x00, 0x00, 0x58, 0x02, 0x10,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x10, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x2c, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
   0x51, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x21, 0x0c, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x10, 0x00, 0x02, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
   0x40, 0x52, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x08, 0x00,
   0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x42, 0x12, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x10, 0x00, 0x49, 0x00, 0x40, 0x08, 0x00, 0x00, 0x00, 0x00, 0x43,
   0x12, 0x20, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x12, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x80, 0x80, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xd0, 0x12, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0xc0, 0x27, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x00,
   0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x40, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x00, 0x10, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x40, 0x00, 0x10, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0xfe, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10,
   0x00, 0x10, 0x00, 0x04, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x21,
   0x0c, 0x00, 0x00, 0x00, 0x40, 0x01, 0x10, 0x80, 0x84, 0x00, 0x00, 0x02,
   0x00, 0x00, 0x00, 0x40, 0x52, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10,
   0x80, 0x80, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x42, 0x12, 0x00,
   0x00, 0x00, 0xa0, 0x00, 0x10, 0x00, 0xb7, 0x00, 0x00, 0x0a, 0x00, 0x00,
   0x00, 0x00, 0x42, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
   0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x80, 0x81, 0x12, 0x20, 0x00, 0x00,
   0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80,
   0x90, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xc0, 0x73, 0x0c, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x06, 0x10,
   0x00, 0xe0, 0x1c, 0x00, 0x00, 0x00, 0x00, 0x80, 0x03, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x40, 0x10, 0x10, 0x00, 0xe0, 0x1c, 0x00, 0x00, 0x00, 0x00,
   0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x40,
   0x1c, 0x00, 0x00, 0x00, 0x00, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x10, 0x40, 0x10, 0x40, 0xd5, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x70, 0x00,
   0x00, 0x00, 0x00, 0x00, 0xa0, 0x88, 0x00, 0x10, 0xe0, 0xff, 0x1b, 0x00,
   0x00, 0x00, 0x00, 0x1c, 0xa0, 0x00, 0x00, 0x00, 0x00, 0xd0, 0x4a, 0x81,
   0x10, 0xe0, 0x00, 0xdb, 0xff, 0xff, 0xff, 0xff, 0x1b, 0xa0, 0xff, 0xff,
   0xff, 0xff, 0xd7, 0x08, 0x22, 0x10, 0xe0, 0xff, 0x5b, 0x55, 0x55, 0x55,
   0x55, 0x0b, 0xa0, 0x55, 0x55, 0x55, 0x55, 0xd5, 0x0a, 0x90, 0x10, 0xe0,
   0xfb, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x04, 0x20, 0x00, 0x00, 0x00, 0x00,
   0xa0, 0x08, 0x00, 0x10, 0xe0, 0xf9, 0x1b, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0xa0, 0x10, 0x40, 0x10, 0xe1, 0xf9, 0x1b,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x20, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x40, 0x18, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x10,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00,
   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
   0x00, 0x00, 0x10, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
   0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x1f };



#define LCD_DATA_BUFFER_SIZE 1024

static u8g2_t u8g2;
static uint8_t LCD_REDRAW_FLAG = 0;

static SemaphoreHandle_t  xSemaphore = NULL;

//Функция инициализации драйвера LCD
void vLCDInit(SemaphoreHandle_t temp)
{
	 xSemaphore = temp;
}



extern TIM_HandleTypeDef htim7;
extern SPI_HandleTypeDef hspi1;

static uint8_t LCD_Buffer[LCD_DATA_BUFFER_SIZE];

//Процедура обновления индикатора
void LCD_Redraw()
{

	uint16_t i=0;
	uint8_t x, y, c, j;
	uint8_t *ptr;
	for (i=0;i<LCD_DATA_BUFFER_SIZE;i++)
	{
		if (LCD_Buffer[i]!=u8g2.tile_buf_ptr[i])
		{
			LCD_Buffer[i]=u8g2.tile_buf_ptr[i];
			LCD_REDRAW_FLAG =1;
		}
	}
	if (LCD_REDRAW_FLAG ==1)
	{
	  HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET );
	  LCD_WriteCommand(0x3E);
	  for (i=0;i<8;i++)
	  {
		  y = i;
		  y*=8;
		  x = 0;
		  if ( y >= 32 )	/* this is the adjustment for 128x64 displays */
		  {
		  	  y-=32;
		  	  x+=8;
		  }
		  ptr = &LCD_Buffer[i*128];	/* data ptr to the tiles */
		  for( j = 0; j < 8; j++ )
		  {
		  	  LCD_WriteCommand(0x080 | (y+j) );
		  	  LCD_WriteCommand(0x080 | x);
		   	  LCD_Send16Data(ptr);
		   	  ptr += 16;
		  }
	  }
	  HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET );
      LCD_REDRAW_FLAG ==0;
	}
}


void StartLcdRedrawTask(void *argument)
{
  /* USER CODE BEGIN StartLCDRedraw */
  /* Infinite loop */
  for(;;)
  {
    osDelay(200);
    LCD_Redraw();
  }
  /* USER CODE END StartLCDRedraw */
}




void LCD_Clear()
{
 LCD_WriteCommand(0x38);
 LCD_WriteCommand(0x01);
  osDelay(2U);
}

//LCD Write Command
inline void LCD_WriteCommand(uint8_t com)
{
	uint8_t Data[3];
	Data[0]=0xF8;
	Data[1]=0xF0 & com;
    Data[2]=0xF0 & (com<<4);
    HAL_SPI_Transmit_DMA(&hspi1, &Data, 3);
    HAL_TIM_Base_Start_IT(&htim7);
    xSemaphoreTake( xSemaphore, portMAX_DELAY );
}


void LCD_Delay()
{
  static portBASE_TYPE xHigherPriorityTaskWoken;

 if (hspi1.State != HAL_SPI_STATE_BUSY_TX)
 {
	  HAL_TIM_Base_Stop_IT(&htim7);
	  xHigherPriorityTaskWoken = pdFALSE;
	  xSemaphoreGiveFromISR(xSemaphore,&xHigherPriorityTaskWoken );
	  portEND_SWITCHING_ISR( xHigherPriorityTaskWoken )

 }

}





inline void LCD_Send16Data( uint8_t *arg_prt)
{
	  uint8_t *data;
	  uint8_t b;
	  uint8_t i;
	  uint8_t Data[33];
	  Data[0]=0xFA;
	  data = (uint8_t *)arg_prt;
	  for (i=0;i<16;i++)
	  {
	   b = *data++;
	   Data[i*2+1]= b & 0x0f0;
	   Data[i*2+2]= b<<4;
	  }
	  HAL_SPI_Transmit_DMA(&hspi1, &Data, 33);
	  HAL_TIM_Base_Start_IT(&htim7);
	  xSemaphoreTake( xSemaphore, portMAX_DELAY );
}


//LCD Reset
void LCD_Reset(void)
{
	HAL_GPIO_WritePin(LCD_RST_GPIO_Port,LCD_RST_Pin,GPIO_PIN_SET);
	//HAL_Delay(100);
	osDelay(10U);
	HAL_GPIO_WritePin(LCD_RST_GPIO_Port,LCD_RST_Pin,GPIO_PIN_RESET);
	osDelay(10U);
	//HAL_Delay(100);
	HAL_GPIO_WritePin(LCD_RST_GPIO_Port,LCD_RST_Pin,GPIO_PIN_SET);
	//HAL_Delay(100);
	osDelay(600U);
}



uint8_t u8x8_stm32_gpio_and_delay(U8X8_UNUSED u8x8_t *u8x8,
    U8X8_UNUSED uint8_t msg, U8X8_UNUSED uint8_t arg_int,
    U8X8_UNUSED void *arg_ptr)
{
  switch (msg)
  {
  case U8X8_MSG_DELAY_MILLI:
    HAL_Delay(arg_int);
    break;
 case U8X8_MSG_DELAY_100NANO:
        __asm__("nop");
        break;
  case U8X8_MSG_GPIO_DC:
    HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, arg_int );
    break;
  case U8X8_MSG_GPIO_RESET:
   // HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, arg_int);
    break;
  }
  return 1;
}

uint8_t u8x8_byte_STM_spi(u8x8_t *u8x8, uint8_t msg, uint8_t arg_int,
    void *arg_ptr)
{
  switch (msg)
  {
  case U8X8_MSG_BYTE_SEND:
    HAL_SPI_Transmit(&hspi1, (uint8_t *) arg_ptr, arg_int, 10000);
   // Delay1us(72);
    break;
  case U8X8_MSG_BYTE_INIT:
    HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, arg_int );
    break;
  case U8X8_MSG_BYTE_SET_DC:
    HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, arg_int );
    break;
  case U8X8_MSG_BYTE_START_TRANSFER:
    HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_SET );
    break;
  case U8X8_MSG_BYTE_END_TRANSFER:
	HAL_GPIO_WritePin( LCD_CS_GPIO_Port, LCD_CS_Pin, GPIO_PIN_RESET );
    break;
  default:
    return 0;
  }
  return 1;
}



static char str[2]={'0',0};
void vLCD_Init()
{

	u8g2_Setup_st7920_s_128x64_f(&u8g2, U8G2_R0, u8x8_byte_STM_spi, u8x8_stm32_gpio_and_delay);
    u8g2_InitDisplay(&u8g2);
    u8g2_SetPowerSave(&u8g2, 0);
}

static uint8_t x =10;
static uint8_t y =10;
static uint8_t x_dir=0;
static uint8_t y_dir=0;
static uint8_t demo_step=22,dl=0,SS=0;
void IncData()
{
	/*u8g2_font_4x6_t_cyrillic
	u8g2_font_5x7_t_cyrillic
	u8g2_font_5x8_t_cyrillic
	u8g2_font_6x12_t_cyrillic
	u8g2_font_6x13_t_cyrillic
	u8g2_font_6x13B_t_cyrillic
	u8g2_font_7x13_t_cyrillic
	u8g2_font_8x13_t_cyrillic
	u8g2_font_9x15_t_cyrillic
	u8g2_font_10x20_t_cyrillic
	u8g2_font_cu12_t_cyrillic
	u8g2_font_unifont_t_cyrillic
	u8g2_font_haxrcorp4089_t_cyrillic
	u8g2_font_inr24_t_cyrillic
	u8g2_font_inr27_t_cyrillic
	u8g2_font_inr30_t_cyrillic
	u8g2_font_inr33_t_cyrillic
	u8g2_font_inr38_t_cyrillic
	u8g2_font_inr42_t_cyrillic
	u8g2_font_inr46_t_cyrillic
	u8g2_font_inr49_t_cyrillic
	u8g2_font_inr53_t_cyrillic
	*/

	//Демонтсрация шрифтов.
	u8g2_ClearBuffer(&u8g2);
	switch (demo_step)
	{
		case 1:
		case 2:
		case 3:
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 10, "font_4x6");
			u8g2_SetFont(&u8g2, u8g2_font_4x6_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 20, "Ф Ж Щ ф ж щ ш 123456dtr");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 30, "font_5x7");
			u8g2_SetFont(&u8g2, u8g2_font_5x7_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0,40, "Ф Ж Щ ф ж щ ш 123456drt");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 50, "font_5x8");
			u8g2_SetFont(&u8g2, u8g2_font_5x8_t_cyrillic);
     	u8g2_DrawUTF8(&u8g2, 0, 60, "Ф Ж Щ ф ж щ ш 123456dtr");
			break;
		case 4:
	    case 5:
	    case 6:
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 10, "font_6x12");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 20, "ФЖЩфжщш 123drt");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 30, "font_6x13");
			u8g2_SetFont(&u8g2, u8g2_font_6x13_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 40, "ФЖЩфжщш 123drt");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 52, "font_6x13b");
			u8g2_SetFont(&u8g2, u8g2_font_6x13B_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 62, "ФЖЩфжщш 123drt");
			break;
		case 7:
		case 8:
		case 9:
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 10, "font_7x13");
			u8g2_SetFont(&u8g2, u8g2_font_7x13_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 20, "ФЖЩфжщш");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 30, "font_8x13");
			u8g2_SetFont(&u8g2, u8g2_font_8x13_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 00, 40, "ФЖЩфжщш1234567890-квпкы");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 52, "font_9x15");
			u8g2_SetFont(&u8g2, u8g2_font_9x15_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 00,63, "ФЖЩфжщш");
			break;
		case 10:
		case 11:
		case 12:
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 12, "font_10x20");
			u8g2_SetFont(&u8g2, u8g2_font_10x20_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 30, "ФЖЩфжщш 123");
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 42, "font_cur12");
			u8g2_SetFont(&u8g2, u8g2_font_cu12_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 60, "ФЖЩфжщш 123");
			break;
		case 13:
		case 14:
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 7, "font_unifont");
			u8g2_SetFont(&u8g2, u8g2_font_unifont_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 00, 20, "ФЖЩфжщш 123try");
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 30, "font_inr24");
			u8g2_SetFont(&u8g2, u8g2_font_inr24_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 00, 60, "ФЖЩфж");
			break;
		case 15:
		case 16:
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetFont(&u8g2, u8g2_font_6x12_te);
			u8g2_DrawUTF8(&u8g2, 0, 12, "font_inr27");
			u8g2_SetFont(&u8g2, u8g2_font_inr27_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 0, 55, "фжщш");
			break;
		case 17:
		case 18:
		case 19:

			u8g2_SetDrawColor(&u8g2,1);
				u8g2_SetBitmapMode(&u8g2,1);
				u8g2_DrawXBM(&u8g2, 0, 0, light_footer_logo_energan_spb_width,light_footer_logo_energan_spb_height, light_footer_logo_energan_spb_bits);

				if (SS==0)
				{
					u8g2_DrawRBox(&u8g2, 19,36,22,22, 3);
				}
				else
				   u8g2_DrawRFrame(&u8g2, 19, 36,22,22, 3);
				u8g2_SetDrawColor(&u8g2,SS==0?0:1);
				u8g2_DrawXBM(&u8g2, 20, 37, icons8_width, icons8_height, icons8_bits);


				u8g2_SetDrawColor(&u8g2,1);
				if (SS==1)
						u8g2_DrawRBox(&u8g2, 55, 36,22,22, 3);
					else
						u8g2_DrawRFrame(&u8g2, 55, 36,22,22, 3);

				u8g2_SetDrawColor(&u8g2,SS==1?0:1);
				u8g2_DrawXBM(&u8g2, 56, 37, icons8_width, icons8_height, icons8_1_bits);

				u8g2_SetDrawColor(&u8g2,1);
				if (SS==2)
					u8g2_DrawRBox(&u8g2, 89, 36,22,22, 3);
				else
					u8g2_DrawRFrame(&u8g2, 89, 36,22,22, 3);

				u8g2_SetDrawColor(&u8g2,SS==2?0:1);
				u8g2_DrawXBM(&u8g2, 90, 37, icons8_width, icons8_height, icons8_2_bits);
				SS++;
					if (SS==3) SS=0;
			break;
		case 20:
		case 21:
		case 22:
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_SetBitmapMode(&u8g2,1);
			if (SS==0)
				u8g2_DrawRBox(&u8g2, 0,0,20,20, 3);
			u8g2_SetDrawColor(&u8g2,SS==0?0:1);
			u8g2_DrawXBM(&u8g2, 0, 0, icons8_height, icons8_height, home_bits);
			u8g2_SetDrawColor(&u8g2,1);
			if (SS==1)
				u8g2_DrawRBox(&u8g2, 0,21,20,20, 3);
			u8g2_SetDrawColor(&u8g2,SS==1?0:1);
			u8g2_DrawXBM(&u8g2, 0, 21, icons8_width, icons8_height, icons8_1_bits);
			if (SS==2)
				u8g2_DrawRBox(&u8g2, 0,41,20,20, 3);
			u8g2_SetDrawColor(&u8g2,SS==2?0:1);
			u8g2_DrawXBM(&u8g2, 0, 41, icons8_width, icons8_height, icons8_2_bits);
			if (SS==3)
				u8g2_DrawRBox(&u8g2, 106,0,20,20, 3);
			u8g2_SetDrawColor(&u8g2,SS==3?0:1);
			u8g2_DrawXBM(&u8g2, 106, 0, icons8_width, icons8_height, icons8_bits);

			if (SS==4)
				u8g2_DrawRBox(&u8g2, 106,21,20,20, 3);
			u8g2_SetDrawColor(&u8g2,SS==4?0:1);
			u8g2_DrawXBM(&u8g2, 106, 21, icons8_width, icons8_height, akk_bits);
			u8g2_SetDrawColor(&u8g2,1);
			u8g2_DrawXBM(&u8g2, 60, 42, icons8_width, icons8_height, fac_bits);
			u8g2_SetFont(&u8g2, u8g2_font_6x13_t_cyrillic);
			u8g2_DrawUTF8(&u8g2, 22, 12, "время");
			u8g2_DrawUTF8(&u8g2, 21, 37, "напряжение   v");
			u8g2_SetFont(&u8g2, u8g2_font_5x8_t_cyrillic);
			//u8g2_DrawUTF8(&u8g2, 61, 12, "12:54:12");
			char time[9] = {' ',' ',' ',' ',' ',' ',' ',' ',' '};
			eRTCgetTime( time );
			u8g2_DrawUTF8(&u8g2, 61, 12, time);
			char ipStr[16];
			cSERVERgetStrIP( ipStr );
			u8g2_DrawUTF8(&u8g2, 26, 25, ipStr);

			u8g2_DrawUTF8(&u8g2, 84, 37, "200");
			SS++;
								if (SS==5) SS=0;
			break;
		default:
			demo_step=0;
			break;
	}
	//demo_step++;




	//u8g2_DrawCircle(&u8g2, x, y, 10, U8G2_DRAW_ALL);


	/*if (x_dir==0)
		x++;
	else
		x--;
    if (x>=128-10) x_dir=1;
	if (x<=10) x_dir=0;

	if (y_dir==0)
			y++;
		else
			y--;
	if (y>=64-10) y_dir=1;
	if (y<=10) y_dir=0;
*/


}





