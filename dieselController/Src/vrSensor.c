/*
 * vrSensor.c
 *
 *  Created on: 23 июн. 2020 г.
 *      Author: photo_Mickey
 */
/*--------------------------------- Includes ---------------------------------*/
#include "vrSensor.h"
#include "config.h"
/*-------------------------------- Structures --------------------------------*/
static TIM_HandleTypeDef* vrTIM = NULL;
/*--------------------------------- Constant ---------------------------------*/
/*-------------------------------- Variables ---------------------------------*/
static uint16_t vrCounter     = 1U;
static uint16_t vrTeethNumber = 0U;
static fix16_t  vrSpeed       = 0U;
/*-------------------------------- Functions ---------------------------------*/

/*----------------------------------------------------------------------------*/
/*----------------------- PRIVATE --------------------------------------------*/
/*----------------------------------------------------------------------------*/

/*----------------------------------------------------------------------------*/
/*----------------------- PABLICK --------------------------------------------*/
/*----------------------------------------------------------------------------*/
void vVRinit ( TIM_HandleTypeDef* tim )
{
  vrTIM         = tim;
  vrTeethNumber = speedToothNumber.value[0U];
  vrCounter     = 0U;
  return;
}

void vVRextiCallback ( void )
{
  vrCounter++;
  return;
}

void vVRtimCallback ( void )
{
  vrSpeed   = fix16_div( ( fix16_div( fix16_div( F16( vrCounter ), F16( vrTeethNumber ) ), F16( VR_TIM_PERIOD ) ) ), F16( 1000U ) );  /* RPS */
  vrCounter = 0U;
  return;
}

fix16_t fVRgetSpeed( void )
{
  return vrSpeed;
}

/*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*/
/*----------------------------------------------------------------------------*/
